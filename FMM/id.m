% nrows = 100;
% ncols = 100;
% rank = 50;
% p = 0;
% M = [];

% fileID = fopen('M.txt','w');
% fprintf(fileID, '%f'
% 
% for i = 1:nrows
%     for j = 1:ncols
%        M(i,j) = 1 / abs(i - j - ncols); 
%     end
% end
% gauss = rand
% reshape(table2array(gauss), [ncols, rank]);

M =  [8.79,  9.93,  9.83, 5.45,  3.16;
            6.11,  6.91,  5.04, -0.27, 7.98;
           -9.15, -7.93,  4.86, 4.85,  3.01;
            9.57,  1.64,  8.83, 0.74,  5.80;
           -3.49,  4.02,  9.80, 10.00,  4.27;
            9.84,  0.15, -8.99, -6.02, -5.31];
gauss = [   -0.0915,    0.7352,   -0.7581,    1.2603;
    0.5578,    0.3510,    1.2075,   -0.9663;
   -0.8848,    0.9110,   -1.3710,    0.7351;
    0.1427,   -0.0160,    1.3716,  -0.2503;
    1.0225,    1.5506,   -0.3009,   -0.7037];

% gauss = [   -0.0915,    0.7352,   -0.7581,    1.2603, 0.543;
%     0.5578,    0.3510,    1.2075,   -0.9663, 0.4321;    
%    -0.8848,    0.9110,   -1.3710,    0.7351, -0.422;    
%     0.1427,   -0.0160,    1.3716,  -0.2503, 1.34;
%     1.0225,    1.5506,   -0.3009,   -0.7037, 0.842]
nrows = 6;
ncols = 5;
rank = 4;
% gauss = randn(ncols, rank)
errors = 0;
niters = 10;
%gauss = randn(ncols, rank + p);
Y = M * gauss;
[q,r] = qr(Y, 0);
bt = M'*q;
[Qhat, Rhat] = qr(bt,0);
[Uhat, S, Vhat] = svd(Rhat);
Uhat = Uhat(:,1:rank); Vhat = Vhat(:,1:rank); S = S(1:rank,1:rank);
U = q*Vhat;
V = Qhat*Uhat;
V'
M_new = U*S*V';
errors = errors + norm(M - M_new) / norm(M)


a =     [1,2,3,4,5;
    1,2,3,4,5;
    1,2,3,4,5;
    1,2,3,4,5]


b = [1,2,3,4;
    1,2,3,4;
    1,2,3,4;
    1,2,3,4;
    1,2,3,4
    ]

c = [2, 4, 6, 8; 
4, 6, 8, 10; 
6, 8, 10, 12; 
8, 10, 12, 14]




% 
% k = 3; % target rank
% p = 0; % over sampling parameter?
% gauss =    [
%     -0.2938, 0.3075, -1.3320;
%    -0.8479, -1.2571, -2.3299;
%    -1.1201, -0.8655, -1.4491;
%     2.5260, -0.1765,  0.3335;
%     1.6555,  0.7914,  0.3914];
% Y = A * gauss % 
% [Q, R] = qr(Y,0);
% B = Q' * A;
% 
% 
% 
% 
% [Uhat, D, V] = svd(B)
% U = Q * Uhat;
% U_new = U(:,1:k); V_new = V(:,1:k); D_new = D(1:k,1:k);
% low_rank = U_new*D_new*V_new'
% A
% rank(low_rank)
% 
% 
% 
% p =  [-10.36, -11.38, -17.86,  -8.45, -10.42;
%  -15.51,  -7.44,   8.37,   9.65,   2.56;
%   -7.02,   4.84,   2.66,   3.74,   3.28;
%   -0.96,  -2.82,   0.08,  -0.03,   3.71;
%   -0.93 , -3.44,   2.12,  -3.39,   4.80]
% 
% 
% a= [  -0.05,  -0.17,  -0.61,   0.11,  -0.53;
%   -0.37,  -0.12,  -0.08,  -0.88,   0.18;
%   -0.40,  -0.34,   0.29,   0.39,   0.45;
%    0.05,  -0.90,   0.05,  -0.03,  -0.18;
%   -0.57,   0.07,  -0.57,   0.24,   0.26;
%    0.61,  -0.16,  -0.45,  -0.04 ,  0.62]
% b = [ 27.47,   0.00,   0.00,   0.00,   0.00;
%    0.00,  22.64,   0.00,   0.00,   0.00;
%    0.00,   0.00,   8.56,   0.00,   0.00;
%    0.00,   0.00,   0.00,   5.99,   0.00;
%    0.00,   0.00,   0.00,   0.00,   2.01]
% 
% c = [  -0.89,  -0.43,   0.13,  -0.01,   0.01;
%   -0.45,   0.81,  -0.36,   0.10,   0.08;
%   -0.06,   0.37,   0.85,   0.01,  -0.38;
%    0.00,  -0.12,  -0.29,   0.56,  -0.76;
%    0.04,  -0.02,   0.24,   0.82,   0.52]
% 
